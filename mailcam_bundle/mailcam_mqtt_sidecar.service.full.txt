# /etc/systemd/system/mailcam_mqtt_sidecar.service
[Unit]
Description=Mailcam delivery-state sidecar (MQTT -> /var/tmp/mailcam_delivery_state.json)
After=network-online.target
Wants=network-online.target

[Service]
User=user
ExecStart=/home/user/restreamenv/bin/python /usr/local/bin/mailcam_sidecar.py
Restart=always
RestartSec=2

# ---- Configuration ----
# MQTT broker (HA Mosquitto add-on lives on 10.0.0.2)
Environment=MAILCAM_MQTT_HOST=10.0.0.2
Environment=MAILCAM_MQTT_USER=delivery
Environment=MAILCAM_MQTT_PASS=gbk-29-bbx!
Environment=MAILCAM_MQTT_TOPIC=home/mailcam/delivery

# Where to write today/current state for the overlay
Environment=MAILCAM_STATE_FILE=/var/tmp/mailcam_delivery_state.json

# Reset the "today" list each day at 03:00
Environment=MAILCAM_RESET_HOUR=3
# -----------------------

# Keep a tiny working dir so relative paths (if any) are sane
WorkingDirectory=/var/tmp
